<!DOCTYPE HTML !>
<html>
    <head>
        <link type="text/css" rel="stylesheet" href="style.css" />
        <meta charset="utf-8" />
        <title>Jingle Bingo</title>
    </head>
    <body>
        <header>
            <h1>Jinglebell Bingo</h1>
        </header>
        <div class="main">
            <div id="grid"></div>
            <div id="win">You're a winner!<br>(sort of).<br><a id="prize">Here's your prize</a></div>
        </div>
    <footer>
Looks best in <a href="http://www.mozilla.org/en-US/firefox/aurora/">Firefox Aurora</a><a href="http://www.mozilla.org/en-US/firefox/nightly/">+</a><br>
<a href="https://github.com/jrconlin/jingo">Fork me like you mean it, baby</a>
</footer>
    </body>
    <script>
        
        var songs = [
                "Twelve Days of Christmas",
                "O Tannenbaum",
                "Jingle Bells",
                "God Rest Ye Merry Gentleman",
                "Deck the Halls",
                "Christmas Song",
                "Sleigh Ride",
                "White Christmas",
                "Beginning to Look A Lot Like Christmas",
                "Carol of the Bells",
                "Have Yourself a Merry Little Christmas",
                "Rockin' Around the Christmas Tree",
                "Most Wonderful Time of the Year",
                "Granma Got Run Over by a Reindeer",
                "Frosty the Snowman",
                "Rudolph the Red Nosed Reindeer",
                "We Three Kings",
                "Carol of the Bells",
                "Silver Bells",
                "Blue Christmas",
                "Mele Kalikimaka",
                "Winter Wonderland",
                "I'll Be Home For Christmas",
                "Silent Night",
                "Joy to the World",
                "Hark! The Herald Angels Sing",
                "O Holy Night",
                "Little Drummer Boy",
                "What Child is This?",
                "Do You Hear What I Hear?",
                "Ave Maria",
                "O Come All Ye Faithful",
                "Gloria",
                "Marshmallow World",
                "Grown-up Christmas Wish",
                "All I Want for Christmas",
                "I Saw Mommy Kissing Santa Claus",
                "Silver Bells",
            ];
        
        prizes=['CRRKXkP6lzw','C6fWyhrod44','Dx5x-Bg0AzU','DXDJbqws3MY','J9FsMKERrl4',
                'JCQOP21WiyM','Nj6SO_yKMe8','QzxAHBUTEzg','XN25TcN--I8','S5UpGx6470',
                'bwE5eB3SXUk','gIJTDwyQw5Y','id10ASJMzHA','jq3-wZs64n4&','j95HbhTl60k',
                'jTdzaTd8tEQ','j-v-UjJE2ss','mhDHiXKKXek','sZTpLvsYYHw','yTk6eY9EY5g'
                ];
        
        var candidates = songs.sort(function(){return 0.5 - Math.random()}).splice(0,24);
        var card = [0,0,0x8,0,0];
        
        function addClass(obj, className) {
            if (obj.className.indexOf(className) < 1){
                obj.className += " "+className;
            }
        }
        
        function showWin()
        {
            console.debug('winning!');
            prize = prizes.sort(function(){return 0.5 - Math.random()}).pop()
            pallet_cleanser = "http://www.youtube.com/watch?v=" + prize;
            document.getElementById('prize').href = pallet_cleanser;
            document.getElementById('grid').className = "fade";
            document.getElementById('win').style.display="block";
        }
        
        function registerHit(rowcol){
            card[rowcol[0]] |= Math.pow(2,rowcol[1]);
            // check rows
            var win = false;
            var cols = 31;
            for (var i=0; i<5; i++) {
                if (card[i] == 62) {
                    win = true
                    console.debug('row', i)
                }
                cols &= card[i];
            }
            if (cols > 0) {
                win = true;
                console.debug('cols', cols)
                }
            // diagonal
            if ((card[0] & 32) && (card[1] & 16) && (card[2] & 8) && (card[3] & 4) && (card[4] & 2)) {
                console.debug('diag 1');
                win = true;
            }
            if ((card[4] & 32) && (card[3] & 16) && (card[2] & 8) && (card[1] & 4) && (card[0] & 2)) {
                console.debug('diag 1');
                win = true;
            }
            if (win) {
                showWin();
            }
        }
        
        function heardSong(event){
            console.debug(event);
            target = event.target;
            addClass(target, "heardIt");
            rowcol = target.dataset.pos.split(':');
            registerHit(rowcol);
            window.lastHit = target;
        }
        
        function makeGrid(candidates) {
            var pos = 0
            var rows = [5,5,4,5,5];
            var grid = document.getElementById('grid');
            for (var rn=0; rn < 5; rn++) {
                var row = document.createElement('div');
                row.setAttribute('class', 'row');
                for (count=5;count > 0; count--){
                    var cell = document.createElement('div');
                    var content = document.createElement('div')
                    cell.setAttribute('class', 'cell')
                    content.setAttribute('class', 'content')
                    content.setAttribute('data-pos', '' + rn + ':' + count)
                    content.addEventListener('click', heardSong, false)
                    if (rn == 2 && count == 3){
                        content.innerHTML = 'Free Space';
                        content.className += " freeSpace"
                    } else {
                        content.innerHTML = candidates[pos++];
                    }
                    cell.appendChild(content);
                    row.appendChild(cell);
                }
                grid.appendChild(row);
            }
        }
        
        makeGrid(candidates);
        
    </script>
</html>
